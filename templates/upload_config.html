<!DOCTYPE html>
<html>
<head>
    <title>Upload Config</title>
    <!-- Include any necessary CSS and JavaScript files -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

     <script src="static/js/common.js"></script>
<link rel="stylesheet" type="text/css"
          href="static/css/common.css">
</head>
<body>

<div id="banner">
    <!-- Logo, application name, and welcome user label -->
    <table style="width: 100%;">
        <tr>
            <td class="app-logo">
                <!-- Logo goes here -->
                <img src="static/images/truistlogo.png" style="width: 200px;" alt="Logo">
            </td>
            <td class="app-name">
                <!-- Application name goes here -->
                <h1 style="font-size: 36px;">AppHealthWatch - <span style="font-size: 24px;">API Health Check Utility</span></h1>
            </td>
            <td class="welcome-user">
                <!-- Welcome message with username goes here -->
                Welcome User
            </td>
        </tr>
    </table>
</div>
<div id="sidebar">
    <div class="sidebar-menu">
        <!-- Sidebar menu items go here -->
        <div class="sidebar-item">
            <a href="/" class="sidebar-link">
                <span class="sidebar-icon home-icon"></span> Home
            </a>
        </div>
        <div class="sidebar-item">
            <a href="/upload" class="sidebar-link">
                <span class="sidebar-icon upload-icon"></span> Upload
            </a>
        </div>
    </div>
</div>
<div id="main">
    <div class="container">
        <h1 class="mt-5">Upload Configuration File</h1>

        <form id="upload-form" class="mt-3">
            <div class="form-group">
                <label for="appName">Application Name:</label>
                <input type="text" class="form-control" id="appName" name="appName" required>
            </div>

            <div class="custom-file mb-3">
                <input type="file" class="custom-file-input" id="file" name="file" accept=".json" onchange="updateFileName()">
                <label class="custom-file-label" for="file" id="file-label">Choose File</label>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>

        <script>
            function updateFileName() {
                var input = document.getElementById('file');
                var label = document.getElementById('file-label');
                var fileName = input.files[0].name;
                label.innerText = fileName;
            }
        </script>

        <div id="confirm-box" class="hidden"></div>

        <!-- Confirmation Modal -->
        <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmationModalLabel">Confirmation</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p id="confirmationMessage"></p>
                    </div>
                    <div class="modal-footer">
<!--                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
                        <button type="button" class="btn btn-primary" id="confirmButton">OK</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        $(document).ready(function() {
            // Submit form on file upload
            $('#upload-form').submit(function(event) {
                event.preventDefault();
                var formData = new FormData($(this)[0]);

                // Upload file using AJAX
                $.ajax({
                    url: '/upload',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        // Show success confirmation
                        showConfirmation(response.message, 'success');
                    },
                    error: function(xhr, status, error) {
                        // Show error confirmation
                        // Print the error details to the console
                        console.log("Error details:", xhr.responseText);
                        showConfirmation('An error occurred. Please try again.' + JSON.parse(xhr.responseText).message, 'error');
                    }
                });
            });

            // Function to show confirmation box
            (function(event) {
            event.preventDefault();
            var formData = new FormData($(this)[0]);

            // Upload file using AJAX
            $.ajax({
                url: '/upload',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // Show success confirmation
                    showConfirmation(response.message, 'Success');
                },
                error: function(xhr, status, error) {
                    // Show error confirmation
                    // Print the error details to the console
                    console.log("Error details:", xhr.responseText);
                    showConfirmation('An error occurred. Please try again. ' + JSON.parse(xhr.responseText).message, 'Error');
                }
            });
        });

        // Function to show confirmation box
<!--        function showConfirmation(message) {-->
<!--            // Set the confirmation message-->
<!--            $('#confirmationMessage').text(message);-->

<!--            // Show the modal-->
<!--            $('#confirmationModal').modal('show');-->

<!--            // Handle OK button click-->
<!--            $('#confirmButton').on('click', function() {-->
<!--                // Hide the modal-->
<!--                $('#confirmationModal').modal('hide');-->
<!--            });-->
<!--        }-->

        function showConfirmation(message, type) {
            var modal = $('#confirmationModal');
            var modalTitle = modal.find('.modal-title');

            // Set modal heading based on type
            modalTitle.text(type.charAt(0).toUpperCase() + type.slice(1));

            $('#confirmationMessage').text(message);
            modal.modal('show');

                        $('#confirmButton').on('click', function() {
                        // Hide the modal
                        $('#confirmationModal').modal('hide');
                    });
        }
        });
    </script>
</body>
</html>
